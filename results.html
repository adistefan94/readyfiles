<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Your Setup Plan — DoneFiles</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:0;line-height:1.5}
    .wrap{max-width:860px;margin:24px auto;padding:16px}
    .card{background:#fff;border:1px solid #eee;border-radius:12px;padding:16px;box-shadow:0 1px 6px rgba(0,0,0,.06);margin:16px 0}
    h1{font-size:1.75rem;margin:.5rem 0}
    .muted{color:#6b7280}
    .grid{display:grid;gap:14px}
    .grid.two{grid-template-columns:1fr 1fr}
    .cta{display:inline-block;border:0;border-radius:12px;padding:12px 16px;background:#0f172a;color:#fff;text-decoration:none}
    .badge{display:inline-block;background:#eef2ff;color:#3730a3;border-radius:999px;font-size:.85rem;padding:4px 10px;margin-right:8px}
    ul{padding-left:18px}
    .paywall{border:1px dashed #9ca3af;border-radius:12px;padding:12px;background:#f9fafb}
    nav{background:#0f172a;color:#fff;padding:10px}
    nav a{color:#fff;margin-right:14px;text-decoration:none}
    .ok{background:#ecfdf5;border:1px solid #10b981;color:#065f46;padding:10px;border-radius:10px;margin-top:10px}
  </style>
</head>
<body>
  <nav class="wrap" style="max-width:980px;">
    <a href="index.html">Home</a>
    <a href="index2.html">CAEN Codes</a>
    <a href="details.html">Business Types</a>
    <strong style="float:right;">DoneFiles</strong>
  </nav>

  <main class="wrap">
    <h1>Your Setup Plan</h1>
    <p class="muted" id="summary"></p>

    <div class="card">
      <div id="badges"></div>
      <h2>Free essentials</h2>
      <ul id="free-list"></ul>
    </div>

    <div class="card paywall">
      <h2>All info — 100% valid (Paid)</h2>
      <p class="muted">City-specific steps, offices, forms, fees, timelines, templates, and pro tips.</p>
      <ul id="pro-preview"></ul>
      <p>
        <a id="buy" class="cta" href="#" target="_blank" rel="noopener">Get the full guide (€14.99)</a>
      </p>
      <div class="ok" id="afterpay" style="display:none;">
        After purchase you’ll receive the full guide by email. Keep your receipt for support.
      </div>
    </div>
  </main>

<script>
  // --- read query params ---
  const params = new URLSearchParams(location.search);
  const selection = {
    entity: params.get('entity') || '',
    industry: params.get('industry') || '',
    caen: params.get('caen') || '',
    city: params.get('city') || '',
    email: params.get('email') || ''
  };

  // Render header
  const summary = document.getElementById('summary');
  summary.textContent = `Entity: ${selection.entity || '—'} • Industry: ${selection.industry || '—'} • CAEN: ${selection.caen || '—'} • City: ${selection.city || '—'}`;

  // badges
  document.getElementById('badges').innerHTML =
    (selection.city ? `<span class="badge">${selection.city}</span>` : '') +
    (selection.entity ? `<span class="badge">${selection.entity}</span>` : '') +
    (selection.caen ? `<span class="badge">CAEN ${selection.caen.split('—')[0].trim()}</span>` : '');

  // Load guides.json (local content DB)
  fetch('assets/guides.json').then(r=>r.json()).then(db=>{
    const key = (selection.caen?.split('—')[0] || '').trim(); // "6201"
    const city = selection.city || 'Generic';
    const byCode = db[key] || db['default'] || {};
    const content = byCode[city] || byCode['Generic'] || db['default']['Generic'];

    // free list
    const freeUl = document.getElementById('free-list');
    (content.free || []).forEach(item=>{
      const li = document.createElement('li'); li.textContent = item; freeUl.appendChild(li);
    });

    // pro preview (teasers)
    const proUl = document.getElementById('pro-preview');
    (content.pro_preview || []).forEach(item=>{
      const li = document.createElement('li'); li.textContent = item; proUl.appendChild(li);
    });
  }).catch(()=>{
    // fallback if guides.json missing
    document.getElementById('free-list').innerHTML = '<li>Company name reservation</li><li>Registered office (contract)</li><li>Founding act basics</li>';
    document.getElementById('pro-preview').innerHTML = '<li>City-specific offices and window numbers</li><li>Exact fees & payment methods</li><li>Filled sample forms & timelines</li>';
  });

  // Stripe Payment Link with prefilled email + reference
  // 1) Replace with your Payment Link URL
  const PAYMENT_LINK = 'https://buy.stripe.com/yourPaymentLinkId';
  // 2) Create a compact reference string (base64 of a JSON)
  const refObj = {entity:selection.entity, industry:selection.industry, caen:selection.caen, city:selection.city};
  const refStr = btoa(unescape(encodeURIComponent(JSON.stringify(refObj))));
  // 3) Build URL with optional prefilled_email & client_reference_id
  const url = new URL(PAYMENT_LINK);
  if (selection.email) url.searchParams.set('prefilled_email', selection.email);
  url.searchParams.set('client_reference_id', refStr);
  document.getElementById('buy').href = url.toString();

  // Simple info after click
  document.getElementById('buy').addEventListener('click', ()=> {
    document.getElementById('afterpay').style.display = 'block';
  });
</script>
</body>
</html>
